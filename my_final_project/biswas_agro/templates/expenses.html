{% extends 'master.html' %}
{% block title %}Expenses{% endblock %}

{% block body %}
<div class="container mt-4">
    <h2>Expenses</h2>
    <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    async function loadCostChart() {
        try {
            const response = await fetch('/api/cost/');
            const data = await response.json();

            const sorted = cost_data //most recent dates
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10)
                .reverse();

            const labels = sorted.map(item => item.date);
            const costData = sorted.map(item => item.cost);

            const ctx = document.getElementById('myChart');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cost',
                        data: costData,
                        backgroundColor: 'rgba(167, 189, 167, 0.6)'
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        } catch (error) {
            console.error("Error loading chart data:", error);
        }
    }

    loadCostChart();
</script>
{% endblock %}